cmake_minimum_required(VERSION 3.20)
project(${PROJECT_NAME} LANGUAGES CXX)

set(CMAKE_CXX_STANDARD ${CXX_STANDARD})
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Enable AUTOUIC, AUTORCC, and AUTOMOC for Qt
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# Find VFX Platform dependencies
find_package(Imath REQUIRED)
find_package(OpenEXR REQUIRED)
find_package(TBB REQUIRED)

# Find Qt6
find_package(Qt6 REQUIRED COMPONENTS Core Gui Qml Quick)

# Find USD
find_package(pxr REQUIRED)

add_executable(${PROJECT_NAME}
    src/main.cpp
    src/resources.qrc
)

target_link_libraries(${PROJECT_NAME}
    PRIVATE
        Imath::Imath
        OpenEXR::OpenEXR
        Qt6::Core
        Qt6::Gui
        Qt6::Qml
        Qt6::Quick
        usd_usd
        usd_usdGeom
)

target_include_directories(${PROJECT_NAME}
    PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}/src
)

# Deployment logic for Windows to copy DLLs
if(WIN32)
    add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_directory
        "${CONDA_PREFIX}/Library/bin"
        $<TARGET_FILE_DIR:${PROJECT_NAME}>
    )
endif()
